<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>게시글 목록</title>
    <style>
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        tr {
            cursor: pointer;
        }
        tr:hover {
            background-color: #f9f9f9;
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .button {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            text-align: center;
            text-decoration: none;
            border-radius: 5px;
            font-size: 16px;
        }
        .button:hover {
            background-color: #0056b3;
        }

        /* 페이징 스타일 */
        .pagination {
            display: flex;
            justify-content: center;
            list-style: none;
            padding-left: 0;
            margin-top: 20px;
        }
        .pagination .page-item {
            margin: 0 5px;
        }
        .pagination .page-link {
            display: inline-block;
            padding: 10px 15px;
            background-color: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 5px;
            color: #007bff;
            text-decoration: none;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .pagination .page-link:hover {
            background-color: #007bff;
            color: white;
        }
        .pagination .page-item.disabled .page-link {
            color: #ccc;
            cursor: not-allowed;
            background-color: #f8f9fa;
        }
        .pagination .page-item.active .page-link {
            background-color: #007bff;
            color: white;
            font-weight: bold;
        }

        .pagination .page-item:first-child .page-link,
        .pagination .page-item:last-child .page-link {
            border-radius: 5px;
        }

        .pagination .page-item .page-link span {
            font-size: 16px;
        }

        /* 검색 및 정렬 스타일 */
        .search-container {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .search-container input[type="text"] {
            padding: 10px;
            font-size: 16px;
            width: 300px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        .search-container select {
            padding: 10px;
            margin-left: 10px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
    </style>
</head>
<body>

<div class="header-container">
    <h1>게시글 목록</h1>
    <a href="/board/write" class="button">게시글 작성</a>
</div>

<!-- 검색 및 정렬 기능 추가 -->
<div class="search-container">
    <form action="/board/findAll" method="get">
        <select name="searchType" id="searchType">
            <option value="" th:selected="${searchType == ''}">검색옵션선택</option>
            <option value="title" th:selected="${searchType == 'title'}">제목</option>
            <option value="writer" th:selected="${searchType == 'writer'}">작성자</option>
        </select>
        <input type="text" name="searchText" placeholder="검색어 입력"
               th:value="${searchText != null ? searchText : ''}">
        <select name="sort" id="sort">
            <option value="" th:selected="${sort == ''}">순서목록</option>
            <option value="title" th:selected="${sort == 'title'}">제목순</option>
            <option value="dateTime" th:selected="${sort == 'dateTime'}">시간순</option>
        </select>
        <select name="orderBy" id="orderBy">
            <option value="" th:selected="${orderBy == ''}">순차</option>
            <option value="asc" th:selected="${orderBy == 'asc'}">▲</option>
            <option value="desc" th:selected="${orderBy == 'desc'}">▼</option>
        </select>
        <input type="text" name="recordSize" placeholder="페이지수" style="width: 60px;"
               th:value="${recordSize != null ? recordSize : '10'}">
        <button type="submit" class="button">검색</button>
    </form>
</div>

<table>
    <thead>
    <tr>
        <th>제목</th>
        <th>내용</th>
        <th>작성자</th>
        <th>시간</th>
    </tr>
    </thead>
    <tbody>
    <!-- 게시글 목록을 반복문으로 출력 -->
    <tr th:each="board : ${boards}" th:data-id="${board.id}">
        <td th:text="${board.title}"></td>
        <td th:text="${board.content}"></td>
        <td th:text="${board.writer}"></td>
        <td th:text="${board.dateTime}"></td>
    </tr>
    </tbody>
</table>

<div th:if="${!boards.isEmpty()}">
    <nav aria-label="Page navigation">
        <ul class="pagination">
            <!-- 첫 페이지로 이동 -->
            <li th:classappend="${boards.first} ? 'disabled' : ''" class="page-item">
                <a class="page-link" th:href="@{/board/findAll(page=0, search=${search}, sort=${sort})}">
                    <span>&laquo;</span>
                    <span class="sr-only">맨처음</span>
                </a>
            </li>

            <!-- 이전 페이지로 이동 -->
            <li th:classappend="${boards.first} ? 'disabled' : ''" class="page-item">
                <a class="page-link" th:href="@{/board/findAll(page=${boards.pageable.pageNumber - 1}, search=${search}, sort=${sort})}" aria-label="Previous">
                    <span aria-hidden="true">&lt;</span>
                    <span class="sr-only">이전</span>
                </a>
            </li>

            <!-- 페이지 번호들 -->
            <li th:each="page: ${#numbers.sequence(boards.pageable.pageNumber - 2 > 0 ? boards.pageable.pageNumber - 2 : 0,
                                                 boards.pageable.pageNumber + 2 < boards.totalPages ? boards.pageable.pageNumber + 2 : boards.totalPages - 1)}"
                th:classappend="${page == boards.pageable.pageNumber} ? 'active' : ''"
                class="page-item">
                <a th:text="${page + 1}" class="page-link" th:href="@{/board/findAll(page=${page}, search=${search}, sort=${sort})}"></a>
            </li>

            <!-- 다음 페이지로 이동 -->
            <li th:classappend="${boards.last} ? 'disabled' : ''" class="page-item">
                <a class="page-link" th:href="@{/board/findAll(page=${boards.pageable.pageNumber + 1}, search=${search}, sort=${sort})}" aria-label="Next">
                    <span aria-hidden="true">&gt;</span>
                    <span class="sr-only">다음</span>
                </a>
            </li>

            <!-- 마지막 페이지로 이동 -->
            <li th:classappend="${boards.last} ? 'disabled' : ''" class="page-item">
                <a class="page-link" th:href="@{/board/findAll(page=${boards.totalPages - 1}, search=${search}, sort=${sort})}">
                    <span>&raquo;</span>
                    <span class="sr-only">맨끝</span>
                </a>
            </li>
        </ul>
    </nav>
</div>

<script type="text/javascript">
    // 각 <tr> 클릭 시 해당 게시글의 상세 페이지로 이동
    document.querySelectorAll("tr[data-id]").forEach(function(row) {
        row.addEventListener("click", function() {
            var boardId = row.getAttribute("data-id");
            if (boardId) {
                window.location.href = "/board/boardFindOne?id=" + encodeURIComponent(boardId) + "&mode=view";
            }
        });
    });
</script>

</body>
</html>
